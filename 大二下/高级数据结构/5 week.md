# 再次强调：什么是数据结构

>对于前面知识的重复强调

DataStructures ：A way of alganizing ==data== into ==conputer systems== so that ==accesses== to data are efficient

1.data
casted as sets
文档搜索：
	看成关键词（/单词）集合，搜索就是搜索内容单词和文档中单词的交，交越多说明相关性越强
图片：
	看成流形上的点的集合，每一个像素点是一个维度，每一个的维度之间存在一定函数关系（隐函数），每一张图片就变成了每一个像素点之间的依赖关系的函数，图像相似，像素点的依赖关系相似
称它为“人工智能”，能够找到相似的图片/文档，比较相似的内部关系
但是最后发现仍需要使用倒排表进行关键词搜索

把数据看成位置，就可以进行逻辑推理

2.conputer systems
云计算、区块链、p2p
“数单词”

3.accesses
查找的时候是：1. one point foreign;2. range foreign;3. exit foreign

4.efficient
和effective的区别

# 时间度量

## 期望

期望时间！=平均时间
每一个发生的概率不一定相等

## 分摊代价

分摊代价=最坏平均代价
举例：
	随机变量存在期望
	随机变量受另一个变量控制
	因此期望本身也会是一个随机变量
	因此存在最大的平均，称为分摊代价
	要让最坏代价最小

## 排序

### 逆序对

排序实际就是消灭一个序列中的所有逆序对
但不是简单的交换位置就可以的
消灭之后尽量不要再增加

- 逆序对
    - 如果 $i<j$，但 $a[i]>a[j]$，则为逆序对
        - 例如：34, 8, 64, 5
        - （34, 8），（34, 5），（8, 5）
    - 事实1：没有逆序对的序列称为已排序的序列
    - 事实2：在交换相邻元素时，仅减少一个逆序对

- 定理1：在随机序列中，逆序对的期望数量为 $n(n−1)/4$。
- 定理2：基于比较的算法的成本是 $Ω(n^2)$。
	- 如果都是像冒泡或者插入排序，每一次比较消灭一个逆序对（有这么多逆序对，注定要$n^2$）

###  定理 1：随机序列中逆序对的期望数量 证明

**结论**  
在长度为 $n$ 的随机序列中，逆序对的期望数量为：

$$
\mathbb{E}[\text{逆序对数量}] = \frac{n(n-1)}{4}
$$
#### 一、定义

在一个长度为 $n$ 的互不相同元素的随机序列中，**逆序对**是满足下列条件的元素对 $(i, j)$：

$$
1 \le i < j \le n,\quad \text{且 } a_i > a_j
$$

我们假设从所有 $n!$ 个不同排列中等概率地选出一个。

#### 二、引入指示变量

令指示变量：

$$
X_{ij} =
\begin{cases}
1, & \text{若 } a_i > a_j \\\\
0, & \text{否则}
\end{cases}
$$

则逆序对总数为：

$$
X = \sum_{1 \le i < j \le n} X_{ij}
$$

根据期望的线性性，有：

$$
\mathbb{E}[X] = \sum_{1 \le i < j \le n} \mathbb{E}[X_{ij}]
$$
在外面的可以放到里面去，和的期望等于期望的和
#### 三、计算单个期望值

由于所有排列等概率，任意 $i < j$ 的两个元素的大小关系也是等概率的：

$$
\mathbb{P}(a_i > a_j) = \mathbb{P}(a_i < a_j) = \frac{1}{2}
$$

因此：

$$
\mathbb{E}[X_{ij}] = \frac{1}{2}
$$

#### 四、求总期望

共有：

$$
\binom{n}{2} = \frac{n(n-1)}{2}
$$

对 $i < j$ 的元素对，所以：

$$
\mathbb{E}[X] = \sum_{1 \le i < j \le n} \mathbb{E}[X_{ij}] = \frac{1}{2} \cdot \frac{n(n-1)}{2} = \frac{n(n-1)}{4}
$$

#### 五、结论

因此，随机序列中逆序对的期望数量为：

$$
\boxed{\frac{n(n-1)}{4}}
$$
巧妙之处：不同的元素都不是独立随机变量，但是期望的计算不包含这部分，不用考虑依赖关系

#### 其他证明方法

#### **递推（数学归纳+期望递推式）
**思路：**

将一个 $n$ 元素的随机序列看成在一个 $(n - 1)$ 元素的随机排列中**插入一个新元素**。

**递推构造：**

1. 假设我们已经知道 $E(n-1)$，即 $n-1$ 个元素的逆序对期望。
    
2. 现在在这个 $n-1$ 个元素的排列中**插入第 $n$ 个元素**，它可能插入到 $n$ 个位置中的任意一个。
    
---

**关键观察：**

- **插入的位置越靠前，越可能产生更多逆序对。**
    
- 设新元素是数字 $x$，为了简化，我们假设插入的是当前序列中**最大的元素 $n$**，它不会对已有逆序对造成影响，但插入位置会影响它和之前元素的关系。
    

实际上，无论插入的是哪个值，由于排列等概率，**新元素与之前的每个元素之间形成逆序的概率是 $1/2$**。

所以，**新插入的元素平均会产生 $\frac{n-1}{2}$ 个逆序对**。

---

 **递推式：**

$E(n)=E(n−1)+n−12E(n) = E(n - 1) + \frac{n - 1}{2}$

---

**初始条件：**

$E(1)=0E(1) = 0$

---

**递推展开：**

$$E(2)=E(1)+12=0+12E(3)
=E(2)+22=12+1=32E(4)
=E(3)+32=32+32=3E(5)
=E(4)+42=3+2=5⋮E(n)
=∑k=1n−1k2
=12∑k=1n−1k
=12⋅(n−1)n2\begin{aligned} E(2) &
= E(1) + \frac{1}{2} = 0 + \frac{1}{2} \\ E(3) &
= E(2) + \frac{2}{2} = \frac{1}{2} + 1 
= \frac{3}{2} \\ E(4) &
= E(3) + \frac{3}{2} 
= \frac{3}{2} + \frac{3}{2} 
= 3 \\ E(5) &= E(4) + \frac{4}{2} 
= 3 + 2 = 5 \\ \vdots \\ E(n) &
= \sum_{k = 1}^{n - 1} \frac{k}{2} 
= \frac{1}{2} \sum_{k = 1}^{n - 1} k 
= \frac{1}{2} \cdot \frac{(n - 1)n}{2} \end{aligned}$$

---

**最终结论：**

$E(n)=n(n−1)4E(n) = \frac{n(n - 1)}{4}$

#### 逆转法


每一个序列都有一个对应的倒序的序列
各自都有逆序对的和，加起来是cn2

设 $A$ 是一个 $n$ 元素的排列，记它的逆序对数量为 $I(A)$。令 $A^{\text{rev}}$ 表示 $A$ 的完全反转排列（即顺序完全反过来），其逆序对数量记为 $I(A^{\text{rev}})$。

对于每一对索引 $(i, j)$，其中 $1 \le i < j \le n$，都有以下性质：

- 如果 $A[i] > A[j]$，那么 $(i, j)$ 是 $A$ 的逆序对。
    
- 在 $A^{\text{rev}}$ 中，$(i, j)$ 会变成 $(n-j+1, n-i+1)$，若 $A[i] > A[j]$，此时对应的是 $A^{\text{rev}}[n-j+1] < A^{\text{rev}}[n-i+1]$，即是顺序对。
    
- 换言之，每一对 $(i, j)$ 在 $A$ 和 $A^{\text{rev}}$ 中，恰好一个是逆序对，另一个是顺序对。
    

因此，对所有 $A$ 和其反转 $A^{\text{rev}}$ 有：

$I(A)+I(Arev)=(n2)=n(n−1)2I(A) + I(A^{\text{rev}}) = \binom{n}{2} = \frac{n(n-1)}{2}$

由于全排列中每一个排列和其反转都是等概率的，设随机排列的逆序对期望为 $E(n)$，则根据排列和其反转配对求平均，有：

$E(n)=I(A)+I(Arev)2=12⋅n(n−1)2=n(n−1)4E(n) = \frac{I(A) + I(A^{\text{rev}})}{2} = \frac{1}{2} \cdot \frac{n(n-1)}{2} = \frac{n(n-1)}{4}$

---

**结论：**  
随机排列中逆序对的期望为：

$$\boxed{E(n) = \frac{n(n-1)}{4}}$$

