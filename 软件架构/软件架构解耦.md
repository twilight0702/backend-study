对应ppt：![[Unit4-7 软件架构解耦.pdf]]
# 耦合

## 什么是低耦合？

耦合度表示模块之间（例如，类与类 之间、子程序与子程序之间）关系的紧 密程度，“低耦合度”是软件设计的目 标。 低耦合模块（类或子程序）之间的关 系尽可能简单，彼此之间的相互依赖性 小，也就是“松散耦合”

## 解耦

### 定义

降低模块之间 的耦合度，也就是尽可能使得模块之间 的耦合是松散耦合。 解耦能够保持组件之间的自主和独立 性。它的直接结果就是改动成本低，维 护成本低，可读性高。

### 微观角度解耦

微观角度解耦是指在**类与类、模块与模块、方法与方法之间**引入**接口、抽象、事件、回调、依赖注入等机制**，从而降低它们之间的直接依赖关系，实现更高的内聚性与更低的耦合性，使得代码更容易扩展、测试与维护

比如遗留软件A,B，要把B加入A，但是格式不匹配，就要使用**适配器**模式

再如：桥接模式（Bridge）将类的抽象部 分和它的实现部分分离开来，使它们可以 独立地变化

### 宏观角度解耦

> 去看《设计模式》这本书，看这个设计模式用于解决什么问题，然后去做实现，回头需要用到的时候再回头来看就行

宏观角度解耦关注的是**系统整体结构层面的耦合关系**，包括不同模块、子系统、服务之间的解耦。常见方法包括分层架构、微服务架构、事件驱动架构、中台架构等，目的是**实现子系统之间逻辑独立、部署独立、演化独立**

从架构风格本身的角度去解耦

# 微内核架构及其解耦应用

## 举例1

例如：美国保险公司索赔处理的改造 ◦ 索赔过程复杂，每个阶段都有很多不同的 规则和条例来说明是否应该得到赔偿。 例如汽车挡风玻璃被岩石击碎，有的州是允许 赔偿的，有的是不允许的。 ◦ 通常保险索赔应用都会使用一个大型的复 杂的规则引擎来处理。 ◦ 但是规则引擎会像滚雪球一样越来越大， 修改一个规则可能会影响其它的规则，这 种紧耦合的应用设计会造成很多问题。

->使用平台插件架构进行解耦。不同的州有不同的规则插件，这样互不影响

## 举例2

例如：一个合同管理系统的改造 ◦ 该系统基于.NET，SAGE CRM二次开发的产 品。 ◦ 系统架构过于陈旧，性能、可靠性无法满 足现有的需求，而且功能繁杂、结构混乱， 定制的代码与SAGE CRM系统耦合度极高。

## 如何改造成微服务？

秉持最小修改原则
### 功能剥离

在现有合同管理系统的外围，逐步 构建功能服务接口，将系统核心的功能分离出 来；同时，使用代理机制，将用户对原有系统 的访问，转发到新的服务中，从而解耦原合同 系统与用户之间的依赖
### 数据解耦
 
随着部分功能的解耦，已经存在一 些微服务能够独立为用户提供功能。这时，逐 渐考虑将数据解耦，从原有的单块架构数据中 剥离相关的业务数据。尽量满足对于每个服务， 有独立的、隔离的业务数据系统

比如说每个不同的微服务有单独的数据库，防止共享数据库带来性能瓶颈
### 数据同步

对于复杂的业务逻辑，在新的服 务（业务逻辑、数据）独立出来后，可采用 ETL的机制，将服务中的业务数据同步到单块 架构的数据库中，保障原有的功能能够被继 续使用

# 总结

根据需求进行优化，然后看看是否会有瓶颈，然后发现问题解决问题。不求一次性解决问题